---
/**
 * Categories Listing Page
 * 
 * Displays all blog categories with post counts.
 */

import { getCollection } from 'astro:content';
import BaseLayout from '@templates/BaseLayout.astro';
import CategoryGrid1 from '@organisms/CategoryGrid1.astro';
import Hero1 from '@organisms/Hero1.astro';

// Get all categories
const allCategories = await getCollection('categories');

// Get all non-draft posts to count posts per category
const allPosts = await getCollection('blog', ({ data }) => {
  return data.draft !== true;
});

// Helper to get clean slug from category id
const getCategorySlug = (id: string) => id.replace(/\.md$/, '');

// Count posts per category
const categoriesWithCounts = allCategories.map((category) => {
  const postCount = allPosts.filter(
    (post) => post.data.category.id === category.id
  ).length;
  
  return {
    slug: getCategorySlug(category.id),
    data: category.data,
    postCount,
  };
});

// Sort categories by post count (most posts first)
const sortedCategories = categoriesWithCounts.sort(
  (a, b) => b.postCount - a.postCount
);
---

<BaseLayout 
  title="Categories" 
  description="Browse blog posts by category."
>
  <main>
    <Hero1
      tagline="Categories"
      heading="Browse by Topic"
      description="Explore our articles organized by topic. Find exactly what you're looking for."
      size="sm"
      background="muted"
    />

    <CategoryGrid1
      categories={sortedCategories}
      columns={2}
      cardVariant="outlined"
      size="lg"
    />
  </main>
</BaseLayout>
